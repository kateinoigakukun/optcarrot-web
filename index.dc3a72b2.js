function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},r={},a=t.parcelRequire8e51;null==a&&((a=function(e){if(e in n)return n[e].exports;if(e in r){var t=r[e];delete r[e];var a={id:e,exports:{}};return n[e]=a,t.call(a.exports,a,a.exports),a.exports}var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){r[e]=t},t.parcelRequire8e51=a),a.register("27Lyk",(function(t,n){var r,a;e(t.exports,"register",(()=>r),(e=>r=e)),e(t.exports,"resolve",(()=>a),(e=>a=e));var s={};r=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)s[t[n]]=e[t[n]]},a=function(e){var t=s[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),a("27Lyk").register(JSON.parse('{"1LzKV":"index.dc3a72b2.js","3YKzz":"optcarrot.worker.b435ce0e.js"}'));const s=Symbol("Comlink.proxy"),i=Symbol("Comlink.endpoint"),o=Symbol("Comlink.releaseProxy"),c=Symbol("Comlink.thrown"),l=e=>"object"==typeof e&&null!==e||"function"==typeof e,u=new Map([["proxy",{canHandle:e=>l(e)&&e[s],serialize(e){const{port1:t,port2:n}=new MessageChannel;return d(e,t),[n,[n]]},deserialize:e=>(e.start(),p(e))}],["throw",{canHandle:e=>l(e)&&c in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function d(e,t=self){t.addEventListener("message",(function n(r){if(!r||!r.data)return;const{id:a,type:s,path:i}=Object.assign({path:[]},r.data),o=(r.data.argumentList||[]).map(b);let l;try{const t=i.slice(0,-1).reduce(((e,t)=>e[t]),e),n=i.reduce(((e,t)=>e[t]),e);switch(s){case"GET":l=n;break;case"SET":t[i.slice(-1)[0]]=b(r.data.value),l=!0;break;case"APPLY":l=n.apply(t,o);break;case"CONSTRUCT":l=y(new n(...o));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;d(e,n),u=t,p=[t],v.set(u,p),l=u}break;case"RELEASE":l=void 0;break;default:return}}catch(e){l={value:e,[c]:0}}var u,p;Promise.resolve(l).catch((e=>({value:e,[c]:0}))).then((e=>{const[r,i]=w(e);t.postMessage(Object.assign(Object.assign({},r),{id:a}),i),"RELEASE"===s&&(t.removeEventListener("message",n),h(t))}))})),t.start&&t.start()}function h(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function p(e,t){return g(e,[],t)}function f(e){if(e)throw new Error("Proxy has been released and is not useable")}function g(e,t=[],n=function(){}){let r=!1;const a=new Proxy(n,{get(n,s){if(f(r),s===o)return()=>E(e,{type:"RELEASE",path:t.map((e=>e.toString()))}).then((()=>{h(e),r=!0}));if("then"===s){if(0===t.length)return{then:()=>a};const n=E(e,{type:"GET",path:t.map((e=>e.toString()))}).then(b);return n.then.bind(n)}return g(e,[...t,s])},set(n,a,s){f(r);const[i,o]=w(s);return E(e,{type:"SET",path:[...t,a].map((e=>e.toString())),value:i},o).then(b)},apply(n,a,s){f(r);const o=t[t.length-1];if(o===i)return E(e,{type:"ENDPOINT"}).then(b);if("bind"===o)return g(e,t.slice(0,-1));const[c,l]=m(s);return E(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:c},l).then(b)},construct(n,a){f(r);const[s,i]=m(a);return E(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:s},i).then(b)}});return a}function m(e){const t=e.map(w);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}const v=new WeakMap;function y(e){return Object.assign(e,{[s]:!0})}function w(e){for(const[t,n]of u)if(n.canHandle(e)){const[r,a]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},a]}return[{type:"RAW",value:e},v.get(e)||[]]}function b(e){switch(e.type){case"HANDLER":return u.get(e.name).deserialize(e.value);case"RAW":return e.value}}function E(e,t,n){return new Promise((r=>{const a=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===a&&(e.removeEventListener("message",t),r(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:a},t),n)}))}var x,C;C=function(e,t,n){if(t===self.location.origin)return e;var r=n?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([r],{type:"application/javascript"}))};let S=new URL(a("27Lyk").resolve("3YKzz"),import.meta.url);x=C(S.toString(),S.origin,!0);const k=p(new Worker(x));class L{constructor(e){this.canvasContext=e.getContext("2d"),this.scalingCanvas=document.createElement("canvas"),this.scalingCanvas.width=e.width,this.scalingCanvas.height=e.height,this.scalingContext=this.scalingCanvas.getContext("2d"),this.canvasContext.scale(2,2)}draw(e){const t=new Uint8ClampedArray(e.buffer),n=new ImageData(t,256,224);this.scalingContext.putImageData(n,0,0),this.canvasContext.drawImage(this.scalingCanvas,0,0)}}class T{constructor(){this.context=new AudioContext({sampleRate:11050}),this.scheduledTime=0}push(e){const t=this.context.createBuffer(1,e.length,this.context.sampleRate),n=this.context.createBufferSource(),r=t.getChannelData(0),a=this.context.currentTime;for(let t=0;t<e.length;t++)r[t]=e[t]/65536;n.buffer=t,n.connect(this.context.destination),a<this.scheduledTime?(n.start(this.scheduledTime),this.scheduledTime+=t.duration):(console.warn("Audio buffer underrun :("),n.start(a),this.scheduledTime=a+t.duration)}}class O{constructor(){this.times=[]}tick(){const e=performance.now();for(;this.times.length>0&&this.times[0]<=e-1e3;)this.times.shift();return this.times.push(e),this.times.length}}document.getElementById("play-button").addEventListener("click",(async()=>{const e=new L(document.getElementById("nes-video")),t=new T;console.log("Initializing Optcarrot...");const n=new O,r=document.getElementById("fps-indicator"),a=document.getElementById("audio-enabled");let s=a.checked;a.onclick=()=>{s=a.checked},k.init(y((t=>{e.draw(t),r.innerText=n.tick().toString()})),y((e=>{s&&t.push(e)})))}));
//# sourceMappingURL=index.dc3a72b2.js.map
