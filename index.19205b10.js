function t(t,e,r,a){Object.defineProperty(t,e,{get:r,set:a,enumerable:!0,configurable:!0})}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},a={},n=e.parcelRequire8e51;null==n&&((n=function(t){if(t in r)return r[t].exports;if(t in a){var e=a[t];delete a[t];var n={id:t,exports:{}};return r[t]=n,e.call(n.exports,n,n.exports),n.exports}var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(t,e){a[t]=e},e.parcelRequire8e51=n),n.register("27Lyk",(function(e,r){var a,n;t(e.exports,"register",(()=>a),(t=>a=t)),t(e.exports,"resolve",(()=>n),(t=>n=t));var s={};a=function(t){for(var e=Object.keys(t),r=0;r<e.length;r++)s[e[r]]=t[e[r]]},n=function(t){var e=s[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),n("27Lyk").register(JSON.parse('{"1LzKV":"index.19205b10.js","7yeQP":"sw.js","3YKzz":"optcarrot.worker.53021b07.js"}'));const s=Symbol("Comlink.proxy"),i=Symbol("Comlink.endpoint"),o=Symbol("Comlink.releaseProxy"),c=Symbol("Comlink.thrown"),l=t=>"object"==typeof t&&null!==t||"function"==typeof t,u=new Map([["proxy",{canHandle:t=>l(t)&&t[s],serialize(t){const{port1:e,port2:r}=new MessageChannel;return h(t,e),[r,[r]]},deserialize:t=>(t.start(),d(t))}],["throw",{canHandle:t=>l(t)&&c in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function h(t,e=self){e.addEventListener("message",(function r(a){if(!a||!a.data)return;const{id:n,type:s,path:i}=Object.assign({path:[]},a.data),o=(a.data.argumentList||[]).map(v);let l;try{const e=i.slice(0,-1).reduce(((t,e)=>t[e]),t),r=i.reduce(((t,e)=>t[e]),t);switch(s){case"GET":l=r;break;case"SET":e[i.slice(-1)[0]]=v(a.data.value),l=!0;break;case"APPLY":l=r.apply(e,o);break;case"CONSTRUCT":l=_(new r(...o));break;case"ENDPOINT":{const{port1:e,port2:r}=new MessageChannel;h(t,r),u=e,d=[e],y.set(u,d),l=u}break;case"RELEASE":l=void 0;break;default:return}}catch(t){l={value:t,[c]:0}}var u,d;Promise.resolve(l).catch((t=>({value:t,[c]:0}))).then((t=>{const[a,i]=w(t);e.postMessage(Object.assign(Object.assign({},a),{id:n}),i),"RELEASE"===s&&(e.removeEventListener("message",r),p(e))}))})),e.start&&e.start()}function p(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function d(t,e){return g(t,[],e)}function f(t){if(t)throw new Error("Proxy has been released and is not useable")}function g(t,e=[],r=function(){}){let a=!1;const n=new Proxy(r,{get(r,s){if(f(a),s===o)return()=>E(t,{type:"RELEASE",path:e.map((t=>t.toString()))}).then((()=>{p(t),a=!0}));if("then"===s){if(0===e.length)return{then:()=>n};const r=E(t,{type:"GET",path:e.map((t=>t.toString()))}).then(v);return r.then.bind(r)}return g(t,[...e,s])},set(r,n,s){f(a);const[i,o]=w(s);return E(t,{type:"SET",path:[...e,n].map((t=>t.toString())),value:i},o).then(v)},apply(r,n,s){f(a);const o=e[e.length-1];if(o===i)return E(t,{type:"ENDPOINT"}).then(v);if("bind"===o)return g(t,e.slice(0,-1));const[c,l]=m(s);return E(t,{type:"APPLY",path:e.map((t=>t.toString())),argumentList:c},l).then(v)},construct(r,n){f(a);const[s,i]=m(n);return E(t,{type:"CONSTRUCT",path:e.map((t=>t.toString())),argumentList:s},i).then(v)}});return n}function m(t){const e=t.map(w);return[e.map((t=>t[0])),(r=e.map((t=>t[1])),Array.prototype.concat.apply([],r))];var r}const y=new WeakMap;function _(t){return Object.assign(t,{[s]:!0})}function w(t){for(const[e,r]of u)if(r.canHandle(t)){const[a,n]=r.serialize(t);return[{type:"HANDLER",name:e,value:a},n]}return[{type:"RAW",value:t},y.get(t)||[]]}function v(t){switch(t.type){case"HANDLER":return u.get(t.name).deserialize(t.value);case"RAW":return t.value}}function E(t,e,r){return new Promise((a=>{const n=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(r){r.data&&r.data.id&&r.data.id===n&&(t.removeEventListener("message",e),a(r.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:n},e),r)}))}class b{constructor(t){this.buffer=t}push(t,e){this.buffer.push(new Uint8Array([t,e?1:0]),void 0)}}class A{static getStorageForCapacity(t,e){if(!e.BYTES_PER_ELEMENT)throw"Pass in a ArrayBuffer subclass";var r=8+(t+1)*e.BYTES_PER_ELEMENT;return new SharedArrayBuffer(r)}constructor(t,e){if(!ArrayBuffer.__proto__.isPrototypeOf(e)&&void 0!==e.BYTES_PER_ELEMENT)throw"Pass a concrete typed array class as second argument";this._type=e,this._capacity=(t.byteLength-8)/e.BYTES_PER_ELEMENT,this.buf=t,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storage=new e(this.buf,8,this._capacity)}type(){return this._type.name}push(t,e){var r=Atomics.load(this.read_ptr,0),a=Atomics.load(this.write_ptr,0);if((a+1)%this._storage_capacity()==r)return 0;var n=null!=e?e:t.length;let s=Math.min(this._available_write(r,a),n),i=Math.min(this._storage_capacity()-a,s),o=s-i;return this._copy(t,0,this.storage,a,i),this._copy(t,i,this.storage,0,o),Atomics.store(this.write_ptr,0,(a+s)%this._storage_capacity()),s}writeCallback(t,e){var r=Atomics.load(this.read_ptr,0),a=Atomics.load(this.write_ptr,0);if((a+1)%this._storage_capacity()==r)return 0;let n=Math.min(this._available_write(r,a),t),s=Math.min(this._storage_capacity()-a,n),i=n-s;return e(new this._type(this.storage.buffer,8+4*a,s),new this._type(this.storage.buffer,8,i)),Atomics.store(this.write_ptr,0,(a+n)%this._storage_capacity()),n}pop(t,e){var r=Atomics.load(this.read_ptr,0),a=Atomics.load(this.write_ptr,0);if(a==r)return 0;var n=null!=e?e:t.length;let s=Math.min(this._available_read(r,a),n),i=Math.min(this._storage_capacity()-r,s),o=s-i;return this._copy(this.storage,r,t,0,i),this._copy(this.storage,0,t,i,o),Atomics.store(this.read_ptr,0,(r+s)%this._storage_capacity()),s}empty(){var t=Atomics.load(this.read_ptr,0);return Atomics.load(this.write_ptr,0)==t}full(){var t=Atomics.load(this.read_ptr,0);return(Atomics.load(this.write_ptr,0)+1)%this._storage_capacity()==t}capacity(){return this._capacity-1}available_read(){var t=Atomics.load(this.read_ptr,0),e=Atomics.load(this.write_ptr,0);return this._available_read(t,e)}available_write(){var t=Atomics.load(this.read_ptr,0),e=Atomics.load(this.write_ptr,0);return this._available_write(t,e)}_available_read(t,e){return(e+this._storage_capacity()-t)%this._storage_capacity()}_available_write(t,e){return this.capacity()-this._available_read(t,e)}_storage_capacity(){return this._capacity}_copy(t,e,r,a,n){for(var s=0;s<n;s++)r[a+s]=t[e+s]}}var S;S=new URL(n("27Lyk").resolve("7yeQP"),import.meta.url).toString(),"serviceWorker"in navigator?navigator.serviceWorker.register(S).then((function(t){console.log("COOP/COEP Service Worker registered",t.scope),t.active&&!navigator.serviceWorker.controller&&window.location.reload()}),(function(t){console.log("COOP/COEP Service Worker failed to register",t)})):console.warn("Cannot register a service worker");class L{constructor(t){this.canvasContext=t.getContext("2d"),this.scalingCanvas=document.createElement("canvas"),this.scalingCanvas.width=t.width,this.scalingCanvas.height=t.height,this.scalingContext=this.scalingCanvas.getContext("2d"),this.canvasContext.scale(2,2)}draw(t){const e=new Uint8ClampedArray(t.buffer),r=new ImageData(e,256,240);this.scalingContext.putImageData(r,0,0),this.canvasContext.drawImage(this.scalingCanvas,0,0)}}class k{constructor(){this.context=new AudioContext({sampleRate:11050}),this.scheduledTime=0}push(t){const e=this.context.createBuffer(1,t.length,this.context.sampleRate),r=this.context.createBufferSource(),a=e.getChannelData(0),n=this.context.currentTime;for(let e=0;e<t.length;e++)a[e]=t[e]/65536;r.buffer=e,r.connect(this.context.destination),n<this.scheduledTime?(r.start(this.scheduledTime),this.scheduledTime+=e.duration):(console.warn("Audio buffer underrun :(",this.scheduledTime-n),r.start(n),this.scheduledTime=n+e.duration)}}class C{constructor(){this.times=[]}tick(){const t=performance.now();for(;this.times.length>0&&this.times[0]<=t-1e3;)this.times.shift();return this.times.push(t),this.times.length}}const T=t=>{switch(t){case"KeyA":return 0;case"KeyB":return 1;case"Space":return 2;case"Enter":return 3;case"ArrowUp":return 4;case"ArrowDown":return 5;case"ArrowLeft":return 6;case"ArrowRight":return 7;default:return null}};var x,O;O=function(t,e,r){if(e===self.location.origin)return t;var a=r?"import "+JSON.stringify(t)+";":"importScripts("+JSON.stringify(t)+");";return URL.createObjectURL(new Blob([a],{type:"application/javascript"}))};let P=new URL(n("27Lyk").resolve("3YKzz"),import.meta.url);x=O(P.toString(),P.origin,!0);const R=d(new Worker(x));"undefined"!=typeof SharedArrayBuffer&&(async t=>{const e=new L(document.getElementById("nes-video")),r=A.getStorageForCapacity(1024,Uint8Array),a=new b(new A(r,Uint8Array));let n=null;console.log("Initializing Optcarrot...");const s=new C,i=document.getElementById("fps-indicator"),o=document.getElementById("audio-enabled");let c=o.checked;o.onclick=()=>{c=o.checked},document.addEventListener("keydown",(t=>{const e=T(t.code);null!==e&&a.push(e,!0)})),document.addEventListener("keyup",(t=>{const e=T(t.code);null!==e&&a.push(e,!1)})),R.init((t=>{const e={"Lan_Master.nes":"/optcarrot/examples/Lan_Master.nes"},r=t.searchParams.get("opt"),a=null===r||"true"===r,n=t.searchParams.get("rom"),s=null===n?"Lan_Master.nes":n,i=[];if(a&&i.push("--opt"),!e[s])throw new Error(`Unknown ROM: ${s}`);return i.push(e[s]),i})(t),_((t=>{e.draw(t),i.innerText=s.tick().toString()})),_((t=>{c&&(null===n&&(n=new k),n.push(t))})),a.buffer.buf)})(new URL(window.location.href));
//# sourceMappingURL=index.19205b10.js.map
