function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},r={},s=t.parcelRequire8e51;null==s&&((s=function(e){if(e in n)return n[e].exports;if(e in r){var t=r[e];delete r[e];var s={id:e,exports:{}};return n[e]=s,t.call(s.exports,s,s.exports),s.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){r[e]=t},t.parcelRequire8e51=s),s.register("27Lyk",(function(t,n){var r,s;e(t.exports,"register",(()=>r),(e=>r=e)),e(t.exports,"resolve",(()=>s),(e=>s=e));var a={};r=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)a[t[n]]=e[t[n]]},s=function(e){var t=a[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),s("27Lyk").register(JSON.parse('{"1LzKV":"index.7e49f2d5.js","3YKzz":"optcarrot.worker.62890690.js"}'));const a=Symbol("Comlink.proxy"),o=Symbol("Comlink.endpoint"),i=Symbol("Comlink.releaseProxy"),c=Symbol("Comlink.thrown"),l=e=>"object"==typeof e&&null!==e||"function"==typeof e,u=new Map([["proxy",{canHandle:e=>l(e)&&e[a],serialize(e){const{port1:t,port2:n}=new MessageChannel;return d(e,t),[n,[n]]},deserialize:e=>(e.start(),g(e))}],["throw",{canHandle:e=>l(e)&&c in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function d(e,t=self){t.addEventListener("message",(function n(r){if(!r||!r.data)return;const{id:s,type:a,path:o}=Object.assign({path:[]},r.data),i=(r.data.argumentList||[]).map(E);let l;try{const t=o.slice(0,-1).reduce(((e,t)=>e[t]),e),n=o.reduce(((e,t)=>e[t]),e);switch(a){case"GET":l=n;break;case"SET":t[o.slice(-1)[0]]=E(r.data.value),l=!0;break;case"APPLY":l=n.apply(t,i);break;case"CONSTRUCT":l=w(new n(...i));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;d(e,n),u=t,g=[t],v.set(u,g),l=u}break;case"RELEASE":l=void 0;break;default:return}}catch(e){l={value:e,[c]:0}}var u,g;Promise.resolve(l).catch((e=>({value:e,[c]:0}))).then((e=>{const[r,o]=y(e);t.postMessage(Object.assign(Object.assign({},r),{id:s}),o),"RELEASE"===a&&(t.removeEventListener("message",n),h(t))}))})),t.start&&t.start()}function h(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function g(e,t){return m(e,[],t)}function p(e){if(e)throw new Error("Proxy has been released and is not useable")}function m(e,t=[],n=function(){}){let r=!1;const s=new Proxy(n,{get(n,a){if(p(r),a===i)return()=>b(e,{type:"RELEASE",path:t.map((e=>e.toString()))}).then((()=>{h(e),r=!0}));if("then"===a){if(0===t.length)return{then:()=>s};const n=b(e,{type:"GET",path:t.map((e=>e.toString()))}).then(E);return n.then.bind(n)}return m(e,[...t,a])},set(n,s,a){p(r);const[o,i]=y(a);return b(e,{type:"SET",path:[...t,s].map((e=>e.toString())),value:o},i).then(E)},apply(n,s,a){p(r);const i=t[t.length-1];if(i===o)return b(e,{type:"ENDPOINT"}).then(E);if("bind"===i)return m(e,t.slice(0,-1));const[c,l]=f(a);return b(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:c},l).then(E)},construct(n,s){p(r);const[a,o]=f(s);return b(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:a},o).then(E)}});return s}function f(e){const t=e.map(y);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}const v=new WeakMap;function w(e){return Object.assign(e,{[a]:!0})}function y(e){for(const[t,n]of u)if(n.canHandle(e)){const[r,s]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},s]}return[{type:"RAW",value:e},v.get(e)||[]]}function E(e){switch(e.type){case"HANDLER":return u.get(e.name).deserialize(e.value);case"RAW":return e.value}}function b(e,t,n){return new Promise((r=>{const s=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===s&&(e.removeEventListener("message",t),r(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),n)}))}class x{constructor(e){this.canvasContext=e.getContext("2d"),this.scalingCanvas=document.createElement("canvas"),this.scalingCanvas.width=e.width,this.scalingCanvas.height=e.height,this.scalingContext=this.scalingCanvas.getContext("2d"),this.canvasContext.scale(2,2)}draw(e){const t=new Uint8ClampedArray(e.buffer),n=new ImageData(t,256,240);this.scalingContext.putImageData(n,0,0),this.canvasContext.drawImage(this.scalingCanvas,0,0)}}class k{constructor(){this.context=new AudioContext({sampleRate:11050}),this.scheduledTime=0}push(e){const t=this.context.createBuffer(1,e.length,this.context.sampleRate),n=this.context.createBufferSource(),r=t.getChannelData(0),s=this.context.currentTime;for(let t=0;t<e.length;t++)r[t]=e[t]/65536;n.buffer=t,n.connect(this.context.destination),s<this.scheduledTime?(n.start(this.scheduledTime),this.scheduledTime+=t.duration):(console.warn("Audio buffer underrun :(",this.scheduledTime-s),n.start(s),this.scheduledTime=s+t.duration)}}class S{constructor(){this.times=[]}tick(){const e=performance.now();for(;this.times.length>0&&this.times[0]<=e-1e3;)this.times.shift();return this.times.push(e),this.times.length}}const C=e=>{switch(e){case"KeyZ":return 0;case"KeyX":return 1;case"Enter":return 2;case"Space":return 3;case"ArrowUp":return 4;case"ArrowDown":return 5;case"ArrowLeft":return 6;case"ArrowRight":return 7;default:return null}};var L,T;T=function(e,t,n){if(t===self.location.origin)return e;var r=n?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([r],{type:"application/javascript"}))};let A=new URL(s("27Lyk").resolve("3YKzz"),import.meta.url);L=T(A.toString(),A.origin,!0);const R=g(new Worker(L)),O=new class{constructor(e,t){this.progress=e,this.progress.max=1,this.message=t}log(e){this.message.innerText=e}error(e){this.message.innerText=e,this.progress.hidden=!0}setProgress(e){this.progress.value=e}hide(){this.progress.hidden=!0,this.message.hidden=!0}}(document.getElementById("loading-progress"),document.getElementById("loading-message"));(async(e,t)=>{const n=new x(document.getElementById("nes-video"));let r=null;t.log("Initializing Optcarrot...");const s=new S,a=document.getElementById("fps-indicator"),o=document.getElementById("audio-enabled");let i=o.checked;o.onclick=()=>{i=o.checked},document.addEventListener("keydown",(e=>{const t=C(e.code);null!==t&&(e.preventDefault(),R.pushKeyEvent(t,!0))})),document.addEventListener("keyup",(e=>{const t=C(e.code);null!==t&&R.pushKeyEvent(t,!1)}));const c=(e=>{const t=e.searchParams.get("opt"),n=e.searchParams.get("headless"),r=e.searchParams.get("rom");return{opt:null===t||"true"===t,headless:null!==n&&"true"===n,rom:null===r?"Lan_Master.nes":r}})(e),l=c.headless?e=>{a.innerText=s.tick().toString()}:e=>{n.draw(e),a.innerText=s.tick().toString()};R.init(c,w(l),w((e=>{i&&(null===r&&(r=new k),r.push(e))})),w((e=>{switch(e.kind){case"error":t.error(e.message);break;case"message":t.log(e.value);break;case"done":t.hide();break;case"progress":t.setProgress(e.value)}})))})(new URL(window.location.href),O);
//# sourceMappingURL=index.7e49f2d5.js.map
