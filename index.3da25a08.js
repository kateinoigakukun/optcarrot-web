function e(e,t,r,a){Object.defineProperty(e,t,{get:r,set:a,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},a={},s=t.parcelRequire8e51;null==s&&((s=function(e){if(e in r)return r[e].exports;if(e in a){var t=a[e];delete a[e];var s={id:e,exports:{}};return r[e]=s,t.call(s.exports,s,s.exports),s.exports}var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){a[e]=t},t.parcelRequire8e51=s),s.register("27Lyk",(function(t,r){var a,s;e(t.exports,"register",(()=>a),(e=>a=e)),e(t.exports,"resolve",(()=>s),(e=>s=e));var n={};a=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)n[t[r]]=e[t[r]]},s=function(e){var t=n[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),s("27Lyk").register(JSON.parse('{"1LzKV":"index.3da25a08.js","7yeQP":"sw.js","3YKzz":"optcarrot.worker.fa3ac007.js"}'));const n=Symbol("Comlink.proxy"),i=Symbol("Comlink.endpoint"),o=Symbol("Comlink.releaseProxy"),c=Symbol("Comlink.thrown"),l=e=>"object"==typeof e&&null!==e||"function"==typeof e,u=new Map([["proxy",{canHandle:e=>l(e)&&e[n],serialize(e){const{port1:t,port2:r}=new MessageChannel;return h(e,t),[r,[r]]},deserialize:e=>(e.start(),d(e))}],["throw",{canHandle:e=>l(e)&&c in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function h(e,t=self){t.addEventListener("message",(function r(a){if(!a||!a.data)return;const{id:s,type:n,path:i}=Object.assign({path:[]},a.data),o=(a.data.argumentList||[]).map(v);let l;try{const t=i.slice(0,-1).reduce(((e,t)=>e[t]),e),r=i.reduce(((e,t)=>e[t]),e);switch(n){case"GET":l=r;break;case"SET":t[i.slice(-1)[0]]=v(a.data.value),l=!0;break;case"APPLY":l=r.apply(t,o);break;case"CONSTRUCT":l=_(new r(...o));break;case"ENDPOINT":{const{port1:t,port2:r}=new MessageChannel;h(e,r),u=t,d=[t],y.set(u,d),l=u}break;case"RELEASE":l=void 0;break;default:return}}catch(e){l={value:e,[c]:0}}var u,d;Promise.resolve(l).catch((e=>({value:e,[c]:0}))).then((e=>{const[a,i]=w(e);t.postMessage(Object.assign(Object.assign({},a),{id:s}),i),"RELEASE"===n&&(t.removeEventListener("message",r),p(t))}))})),t.start&&t.start()}function p(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function d(e,t){return f(e,[],t)}function g(e){if(e)throw new Error("Proxy has been released and is not useable")}function f(e,t=[],r=function(){}){let a=!1;const s=new Proxy(r,{get(r,n){if(g(a),n===o)return()=>E(e,{type:"RELEASE",path:t.map((e=>e.toString()))}).then((()=>{p(e),a=!0}));if("then"===n){if(0===t.length)return{then:()=>s};const r=E(e,{type:"GET",path:t.map((e=>e.toString()))}).then(v);return r.then.bind(r)}return f(e,[...t,n])},set(r,s,n){g(a);const[i,o]=w(n);return E(e,{type:"SET",path:[...t,s].map((e=>e.toString())),value:i},o).then(v)},apply(r,s,n){g(a);const o=t[t.length-1];if(o===i)return E(e,{type:"ENDPOINT"}).then(v);if("bind"===o)return f(e,t.slice(0,-1));const[c,l]=m(n);return E(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:c},l).then(v)},construct(r,s){g(a);const[n,i]=m(s);return E(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:n},i).then(v)}});return s}function m(e){const t=e.map(w);return[t.map((e=>e[0])),(r=t.map((e=>e[1])),Array.prototype.concat.apply([],r))];var r}const y=new WeakMap;function _(e){return Object.assign(e,{[n]:!0})}function w(e){for(const[t,r]of u)if(r.canHandle(e)){const[a,s]=r.serialize(e);return[{type:"HANDLER",name:t,value:a},s]}return[{type:"RAW",value:e},y.get(e)||[]]}function v(e){switch(e.type){case"HANDLER":return u.get(e.name).deserialize(e.value);case"RAW":return e.value}}function E(e,t,r){return new Promise((a=>{const s=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(r){r.data&&r.data.id&&r.data.id===s&&(e.removeEventListener("message",t),a(r.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),r)}))}class b{constructor(e){this.buffer=e}push(e,t){this.buffer.push(new Uint8Array([e,t?1:0]),void 0)}}class A{static getStorageForCapacity(e,t){if(!t.BYTES_PER_ELEMENT)throw"Pass in a ArrayBuffer subclass";var r=8+(e+1)*t.BYTES_PER_ELEMENT;return new SharedArrayBuffer(r)}constructor(e,t){if(!ArrayBuffer.__proto__.isPrototypeOf(t)&&void 0!==t.BYTES_PER_ELEMENT)throw"Pass a concrete typed array class as second argument";this._type=t,this._capacity=(e.byteLength-8)/t.BYTES_PER_ELEMENT,this.buf=e,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storage=new t(this.buf,8,this._capacity)}type(){return this._type.name}push(e,t){var r=Atomics.load(this.read_ptr,0),a=Atomics.load(this.write_ptr,0);if((a+1)%this._storage_capacity()==r)return 0;var s=null!=t?t:e.length;let n=Math.min(this._available_write(r,a),s),i=Math.min(this._storage_capacity()-a,n),o=n-i;return this._copy(e,0,this.storage,a,i),this._copy(e,i,this.storage,0,o),Atomics.store(this.write_ptr,0,(a+n)%this._storage_capacity()),n}writeCallback(e,t){var r=Atomics.load(this.read_ptr,0),a=Atomics.load(this.write_ptr,0);if((a+1)%this._storage_capacity()==r)return 0;let s=Math.min(this._available_write(r,a),e),n=Math.min(this._storage_capacity()-a,s),i=s-n;return t(new this._type(this.storage.buffer,8+4*a,n),new this._type(this.storage.buffer,8,i)),Atomics.store(this.write_ptr,0,(a+s)%this._storage_capacity()),s}pop(e,t){var r=Atomics.load(this.read_ptr,0),a=Atomics.load(this.write_ptr,0);if(a==r)return 0;var s=null!=t?t:e.length;let n=Math.min(this._available_read(r,a),s),i=Math.min(this._storage_capacity()-r,n),o=n-i;return this._copy(this.storage,r,e,0,i),this._copy(this.storage,0,e,i,o),Atomics.store(this.read_ptr,0,(r+n)%this._storage_capacity()),n}empty(){var e=Atomics.load(this.read_ptr,0);return Atomics.load(this.write_ptr,0)==e}full(){var e=Atomics.load(this.read_ptr,0);return(Atomics.load(this.write_ptr,0)+1)%this._storage_capacity()==e}capacity(){return this._capacity-1}available_read(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_read(e,t)}available_write(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_write(e,t)}_available_read(e,t){return(t+this._storage_capacity()-e)%this._storage_capacity()}_available_write(e,t){return this.capacity()-this._available_read(e,t)}_storage_capacity(){return this._capacity}_copy(e,t,r,a,s){for(var n=0;n<s;n++)r[a+n]=e[t+n]}}var k;k=new URL(s("27Lyk").resolve("7yeQP"),import.meta.url).toString(),"serviceWorker"in navigator?navigator.serviceWorker.register(k).then((function(e){console.log("COOP/COEP Service Worker registered",e.scope),e.active&&!navigator.serviceWorker.controller&&window.location.reload()}),(function(e){console.log("COOP/COEP Service Worker failed to register",e)})):console.warn("Cannot register a service worker");class S{constructor(e){this.canvasContext=e.getContext("2d"),this.scalingCanvas=document.createElement("canvas"),this.scalingCanvas.width=e.width,this.scalingCanvas.height=e.height,this.scalingContext=this.scalingCanvas.getContext("2d"),this.canvasContext.scale(2,2)}draw(e){const t=new Uint8ClampedArray(e.buffer),r=new ImageData(t,256,240);this.scalingContext.putImageData(r,0,0),this.canvasContext.drawImage(this.scalingCanvas,0,0)}}class L{constructor(){this.context=new AudioContext({sampleRate:11050}),this.scheduledTime=0}push(e){const t=this.context.createBuffer(1,e.length,this.context.sampleRate),r=this.context.createBufferSource(),a=t.getChannelData(0),s=this.context.currentTime;for(let t=0;t<e.length;t++)a[t]=e[t]/65536;r.buffer=t,r.connect(this.context.destination),s<this.scheduledTime?(r.start(this.scheduledTime),this.scheduledTime+=t.duration):(console.warn("Audio buffer underrun :(",this.scheduledTime-s),r.start(s),this.scheduledTime=s+t.duration)}}class C{constructor(){this.times=[]}tick(){const e=performance.now();for(;this.times.length>0&&this.times[0]<=e-1e3;)this.times.shift();return this.times.push(e),this.times.length}}class x{constructor(e,t){this.progress=e,this.progress.max=1,this.message=t}log(e){this.message.innerText=e}error(e){this.message.innerText=e,this.progress.hidden=!0}setProgress(e){this.progress.value=e}hide(){this.progress.hidden=!0,this.message.hidden=!0}}const T=e=>{switch(e){case"KeyZ":return 0;case"KeyX":return 1;case"Enter":return 2;case"Space":return 3;case"ArrowUp":return 4;case"ArrowDown":return 5;case"ArrowLeft":return 6;case"ArrowRight":return 7;default:return null}};var P,O;O=function(e,t,r){if(t===self.location.origin)return e;var a=r?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([a],{type:"application/javascript"}))};let R=new URL(s("27Lyk").resolve("3YKzz"),import.meta.url);P=O(R.toString(),R.origin,!0);const M=d(new Worker(P));"undefined"!=typeof SharedArrayBuffer&&(async e=>{const t=new x(document.getElementById("loading-progress"),document.getElementById("loading-message")),r=new S(document.getElementById("nes-video")),a=A.getStorageForCapacity(1024,Uint8Array),s=new b(new A(a,Uint8Array));let n=null;t.log("Initializing Optcarrot...");const i=new C,o=document.getElementById("fps-indicator"),c=document.getElementById("audio-enabled");let l=c.checked;c.onclick=()=>{l=c.checked},document.addEventListener("keydown",(e=>{const t=T(e.code);null!==t&&s.push(t,!0)})),document.addEventListener("keyup",(e=>{const t=T(e.code);null!==t&&s.push(t,!1)})),M.init((e=>{const t={"Lan_Master.nes":"/optcarrot/examples/Lan_Master.nes"},r=e.searchParams.get("opt"),a=null===r||"true"===r,s=e.searchParams.get("rom"),n=null===s?"Lan_Master.nes":s,i=[];if(a&&i.push("--opt"),!t[n])throw new Error(`Unknown ROM: ${n}`);return i.push(t[n]),i})(e),_((e=>{r.draw(e),o.innerText=i.tick().toString()})),_((e=>{l&&(null===n&&(n=new L),n.push(e))})),_((e=>{switch(e.kind){case"error":t.error(e.message);break;case"message":t.log(e.value);break;case"done":t.hide();break;case"progress":t.setProgress(e.value)}})),s.buffer.buf)})(new URL(window.location.href));
//# sourceMappingURL=index.3da25a08.js.map
